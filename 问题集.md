# 问题

> 同样适合于其他项目
> 一些技巧：
> 1. 对于某个项目，一定要事先准备问题；
> 2. 很多问题也都是相通的，比如，问了你“项目的难点是什么？”，那你说了一堆之后，再讲讲“你遇到的问题，及怎么解决”也是ok的；
> 3. 因为事先准备，讲问题才能有条理，这个挺重要的，讲一大堆，面试官听不懂，肯定减分很多，所以挑紧要的讲；
> 4. 先讲概括，细节让面试官来问；但是你可以在把整体讲完之后，提一嘴你想让他问的问题，这样他就顺着你来走了；
> (每个人都不可能全能，一般面试官是想看你掌握了哪些，但他并不知道你擅长什么，所以，你要引导他！)

1. 介绍下你做的这个项目？
   学习了java基础、框架、web这些，想写点东西练手，又觉得单纯的增删改查有点无聊，就在网上搜寻资料写了一个单点登录系统。
   这个单点登录系统，就是一个统一登录服务，设计了一个登录验证服务，比如，A、B、C三个服务都接入了这个单点登录服务，那么只要用户登录了其中一个服务，其他两个服务就不用在登录了，直接可以获取到用户的信息。
   具体的技术使用了Spring-boot、Redis、mysql。
   在写的过程中，流程的梳理比较麻烦，在使用redis的时候也遇到了一点问题。
   
2. 项目的具体内容
   （过程稍微有点绕，最好自己画图，把这个过程理清楚）
   1. 假设服务A介入单点登录服务，在A中写一个servlet filter，拦截该网站下所有控制访问的请求，并重定向到单点服务的登录页面，
   这里需要注意的是，跳转的时候url上会带上get参数，returnUrl表示现在访问的地址，callbackUrl表示当前服务处理登录信息的接口，该app的标识；
   （图中步骤1、2）
   2. 客户重定向请求 单点登录服务，输入用户名密码，登录，验证成功后，
      1. 将用户信息存入redis用以保存用户登录状态；  
      2. 在数据库通过app名，搜索该App的公钥，然后将用户信息通过公钥加密为token，然后一起返回给前端
      前端接收到这些数据后，页面跳转到callbackUrl并且带上token和returnUrl
    （图中步骤3，4）
   3. 请求到达服务A的login接口后，使用私钥解析用户信息，将登录状态存入redis，完成服务A的登录。
   （图中步骤5，6）
      
   概括地讲，就是统一登录服务负责验证用户名密码，这样同一公司的人都可以共用一个用户系统，不需重复建设；然后统一登录服务将用户信息通过公钥加密发给登录的服务，登录的服务，通过自己持有的私钥解密该信息（每个app都需要现在统一登录服务注册，获取唯一的私钥）   
      
3. 你的项目的难点是什么？
   redis客户端的使用
      redis客户端使用的是jedis，jedis不是线程安全的（[jedis线程安全问题](https://www.jianshu.com/p/5e4a1f92c88f "jedis线程安全问题")）
      controller中的方法不是线程安全的，而每次都去创建redis客户端，就需要创建TCP连接，这是非常耗时的，所以这里使用了redis连接池；
      使用jedis连接池的时候出了一点问题，见 **“问题4”**；
   流程比较繁杂
   
4. 这个项目里你有没有遇到什么问题？
   jedis连接池的问题
   遇到了一个问题就是：“服务启动后，反复登陆几次，就会卡住，得不到响应”
   这时通过jstack命令，发现线程卡在了 carrot/demo/sso/controller/LoginController.java:50 
   通过查找网上资料，发现jedisPool中获得的jedis实例，使用完毕后，需要归还到池中，即close操作，close不是关掉客户端，而是归还入池，
   连续登陆几次后，池中没有可分配的客户端，所以再请求会被阻塞住。

5. 就某 **一个“组件/框架”的技术点** 来问问题？
   这个项目就redis而言，对于其他组件也是类似的（所以我们的项目里用到的东西，对它我们一定要多准备，做到足够熟悉），
   问的问题就会涉及如下几个方面：
      1. redis有哪些数据类型？
      2. redis的用处：缓存、分布式锁、共享session等；
         提到缓存，就可能问一些缓存相关问题，
      3. redis的特点：速度快，因为它是纯内存的，并且单线程避免了线程间切换的损耗；
      4. 就redis的一些特性问一些问题，比如：RDB、AOF、哨兵机制、集群实现等等。
   同样容易被考察的模块还有：spring。
 6. 如果涉及具体的业务的项目，面试官可能还会让你讲一讲项目的数据库的设计？表是怎么设计的？为什么这么设计？
      这就是涉及到关系型数据库设计的三大范式，以及性能与范式间的权衡。

 7. 你的单点登录服务是如何保证安全性的？
   概括地讲，就是统一登录服务负责验证用户名密码，这样同一公司的人都可以共用一个用户系统，不需重复建设；然后统一登录服务将用户信息通过公钥加密发给登录的服务，登录的服务，通过自己持有的私钥解密该信息（每个app都需要现在统一登录服务注册，获取唯一的私钥）  
   这样用户名统一登录服务保存，而统一登录服务返回的信息只可以由它指定的服务解析。
